# OpenClaw 国内渠道配置教程

本教程详细介绍如何在钉钉、飞书、企业微信平台端创建应用，并接入 OpenClaw。

> ℹ️ **说明**: OpenClaw 原名 Clawdbot，后更名为 Moltbot，现在正式名称为 OpenClaw。

---

## 目录

1. [钉钉接入](#1-钉钉接入)
2. [飞书接入](#2-飞书接入)
3. [企业微信接入](#3-企业微信接入)
4. [常见问题](#4-常见问题)

---

## 1. 钉钉接入

钉钉是目前最容易配置的渠道，约 5 分钟即可完成。

### 1.1 创建钉钉应用

1. 访问 [钉钉开放平台](https://open-dev.dingtalk.com/fe/app)
2. 登录后点击右上角 **「创建应用」**
3. 填写应用信息：
   - 应用名称：如 `OpenClaw 助手`
   - 应用描述：如 `AI 智能助手`
   - 应用图标：上传一个图标
4. 点击 **「保存」**

### 1.2 获取应用凭证

1. 进入应用详情页，左侧菜单选择 **「凭证与基础信息」**
2. 复制以下信息：
   - **Client ID** (AppKey): 如 `dingxxxxxxxxxxxxxxxx`
   - **Client Secret** (AppSecret): 点击查看后复制

> ⚠️ **重要**: 请妥善保管 Client Secret，不要泄露！

### 1.3 添加机器人能力

1. 在应用详情页，点击 **「添加应用能力」**
2. 找到 **「机器人」** 卡片，点击 **「添加」**
3. 配置机器人：
   - 打开 **机器人配置开关**
   - 填写机器人名称
   - 消息接收模式选择 **「Stream 模式」**
4. 点击 **「发布」**

### 1.4 配置权限

1. 左侧菜单选择 **「开发配置」** → **「权限管理」**
2. 搜索并申请以下权限：
   - `Card.Streaming.Write` - 发送流式卡片
   - `Card.Instance.Write` - 创建卡片实例

### 1.5 发布应用

1. 左侧菜单选择 **「版本管理与发布」**
2. 点击 **「创建新版本」**
3. 填写版本号，选择可见范围（建议先选开发者可见）
4. 点击 **「保存」** → **「直接发布」**

### 1.6 在 OpenClaw 中配置

打开 OpenClaw 设置页面 → 消息渠道 → 点击「新增」选择钉钉 → 填入 Client ID 和 Client Secret

### 1.7 测试

1. 打开钉钉，在工作台找到你创建的应用
2. 发送一条消息，如 `你好`
3. 如果收到回复，说明配置成功！

---

## 2. 飞书接入

飞书支持两种模式：
- **长连接模式** (推荐)：无需公网服务器，配置简单
- **Webhook 模式**：需要公网可访问的回调地址

### 2.1 创建飞书应用

1. 访问 [飞书开放平台](https://open.feishu.cn/app?lang=zh-CN)
2. 登录后点击 **「创建企业自建应用」**
3. 填写应用信息：
   - 应用名称：如 `OpenClaw 助手`
   - 选择应用图标
4. 点击 **「创建」**

### 2.2 获取应用凭证

1. 进入应用管理页，左侧导航栏点击 **「凭证与基础信息」**
2. 复制以下信息：
   - **App ID**: 如 `cli_xxxxxxxxxxxxxxxx`
   - **App Secret**: 点击查看后复制

> ⚠️ **重要**: 请妥善保管 App Secret，不要泄露！

### 2.3 添加机器人能力

1. 左侧导航栏点击 **「添加应用能力」**
2. 选择 **「机器人」**，点击 **「添加」**
3. 配置机器人名称

### 2.4 配置事件订阅（长连接模式）

1. 左侧导航栏点击 **「事件与回调」**
2. 在页面中选择 **「长连接」**
3. 点击 **「保存」**

> 如果提示“未建立长连接”，请先完成 OpenClaw 配置后再返回检查。

### 2.5 配置权限

1. 左侧导航栏点击 **「权限管理」**
2. 搜索并开通以下权限：
   - `im:message` - 获取与发送单聊、群组消息
   - `im:message.group_at_msg` - 接收群聊@机器人消息
   - `im:message.p2p_msg` - 接收用户发给机器人的单聊消息

### 2.6 发布应用

1. 左侧导航栏点击 **「版本管理与发布」**
2. 点击 **「创建版本」**
3. 填写版本信息，选择可见范围
4. 点击 **「保存」** → **「申请发布」**

### 2.7 在 OpenClaw 中配置

打开 OpenClaw 设置页面 → 消息渠道 → 点击「新增」选择飞书 → 填入 App ID 和 App Secret

### 2.8 测试

1. 打开飞书，进入 **「工作台」**
2. 找到你创建的应用，点击进入
3. 发送一条消息，如 `你好`
4. 如果收到回复，说明配置成功！

---

## 3. 企业微信接入

企业微信支持发送消息给个人、部门或群聊。

### 3.1 创建企业微信应用

1. 登录 [企业微信管理后台](https://work.weixin.qq.com/wework_admin/loginpage_wx)
2. 进入 **「应用管理」** → **「应用」**
3. 拉到页面底部，点击 **「自建」** → **「创建应用」**
4. 填写应用信息：
   - 应用 Logo
   - 应用名称：如 `OpenClaw 助手`
   - 应用介绍
   - 选择可见范围
5. 点击 **「创建应用」**

### 3.2 获取企业 ID

1. 进入 **「我的企业」** 页面
2. 拉到页面底部，找到 **「企业 ID」**
3. 复制企业 ID，如 `wwxxxxxxxxxxxxxxxx`

### 3.3 获取应用凭证

1. 进入 **「应用管理」** → 找到你创建的应用
2. 点击应用名称进入详情页
3. 复制以下信息：
   - **AgentId**: 如 `1000002`
   - **Secret**: 点击「查看」后复制

> ⚠️ **重要**: 请妥善保管 Secret，不要泄露！

### 3.4 配置企业可信 IP

1. 在应用详情页，找到 **「企业可信IP」**
2. 点击 **「配置」**
3. 添加你的服务器公网 IP

> 如果不知道服务器 IP，可以在服务器上运行 `curl ip.sb` 查看

### 3.5 配置消息接收（可选）

如果需要接收用户发送的消息：

1. 在应用详情页，找到 **「接收消息」**
2. 点击 **「设置 API 接收」**
3. 填写：
   - **URL**: 你的回调地址，如 `https://your-domain.com/wecom/callback`
   - **Token**: 自定义一个字符串，用于验证
   - **EncodingAESKey**: 点击「随机获取」生成
4. 点击 **「保存」**

### 3.6 在 OpenClaw 中配置

打开 OpenClaw 设置页面 → 消息渠道 → 点击「新增」选择企业微信 → 填入相关信息

### 3.7 测试

1. 打开企业微信
2. 进入 **「工作台」**，找到你创建的应用
3. 发送一条消息，如 `你好`
4. 如果收到回复，说明配置成功！

---

## 4. 常见问题

### 消息发送失败

1. 检查 Token/Secret 是否正确
2. 检查网络是否通畅
3. 检查 IP 白名单是否配置（企业微信）

### 飞书提示“未建立长连接”

确保：
1. App ID 和 App Secret 已正确配置到 OpenClaw
2. OpenClaw Gateway 已启动
3. 再次访问飞书开放平台检查状态

---

## 参考链接

- [钉钉开放平台](https://open.dingtalk.com/)
- [飞书开放平台](https://open.feishu.cn/)
- [企业微信管理后台](https://work.weixin.qq.com/)
- [腾讯云 OpenClaw 一键部署](https://cloud.tencent.com/act/pro/lighthouse-moltbot)
- [阿里云 OpenClaw 部署教程](https://help.aliyun.com/zh/simple-application-server/use-cases/quickly-deploy-and-use-openclaw)
