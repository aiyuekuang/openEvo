# æ ¸å¿ƒåŠŸèƒ½å®ç°æ¸…å•

> åŸºäº OpenClaw æºç åˆ†æï¼Œå…± ~1600 ä¸ªæºæ–‡ä»¶ï¼Œ~41 ä¸‡è¡Œä»£ç 

---

## ä¸€ã€Gateway æ ¸å¿ƒ (src/gateway/)

WebSocket æ§åˆ¶å¹³é¢ï¼Œæ•´ä¸ªç³»ç»Ÿçš„ä¸­æ¢ã€‚

| æ–‡ä»¶/æ¨¡å— | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|----------|------|--------|
| `server.ts` | WebSocket æœåŠ¡å™¨ä¸»å…¥å£ | P0 |
| `client.ts` | WebSocket å®¢æˆ·ç«¯è¿æ¥ç®¡ç† | P0 |
| `boot.ts` | Gateway å¯åŠ¨å¼•å¯¼ | P0 |
| `auth.ts` | è®¤è¯é‰´æƒ | P0 |
| `call.ts` | RPC è°ƒç”¨å¤„ç† | P0 |
| `protocol/` | WebSocket åè®®å®šä¹‰ | P0 |
| `server/` | æœåŠ¡å™¨å®ç°ç»†èŠ‚ | P0 |
| `chat-attachments.ts` | é™„ä»¶å¤„ç† | P1 |
| `chat-sanitize.ts` | æ¶ˆæ¯æ¸…ç†/è¿‡æ»¤ | P1 |
| `assistant-identity.ts` | åŠ©æ‰‹èº«ä»½ç®¡ç† | P1 |

---

## äºŒã€Agent Runtime (src/agents/)

AI å¯¹è¯å¼•æ“ï¼Œæ ¸å¿ƒä¸­çš„æ ¸å¿ƒã€‚

### 2.1 åŸºç¡€è®¾æ–½
| æ–‡ä»¶ | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `context.ts` | å¯¹è¯ä¸Šä¸‹æ–‡ç®¡ç† | P0 |
| `defaults.ts` | é»˜è®¤é…ç½® | P0 |
| `identity.ts` | Agent èº«ä»½ | P0 |
| `identity-file.ts` | èº«ä»½æ–‡ä»¶è¯»å†™ | P0 |
| `agent-paths.ts` | Agent è·¯å¾„ç®¡ç† | P0 |
| `agent-scope.ts` | Agent ä½œç”¨åŸŸ | P0 |

### 2.2 å¯¹è¯æ ¸å¿ƒ
| æ–‡ä»¶ | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `cli-runner.ts` | CLI è¿è¡Œå™¨ | P0 |
| `cli-runner/` | è¿è¡Œå™¨å®ç° | P0 |
| `cli-session.ts` | CLI ä¼šè¯ | P0 |
| `cli-backends.ts` | åç«¯é€‚é… | P0 |
| `compaction.ts` | ä¸Šä¸‹æ–‡å‹ç¼© | P1 |
| `context-window-guard.ts` | ä¸Šä¸‹æ–‡çª—å£ä¿æŠ¤ | P1 |

### 2.3 å·¥å…·ç³»ç»Ÿ
| æ–‡ä»¶ | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `bash-tools.ts` | Bash å·¥å…· | P0 |
| `bash-tools.exec.ts` | å‘½ä»¤æ‰§è¡Œ | P0 |
| `bash-tools.process.ts` | è¿›ç¨‹ç®¡ç† | P0 |
| `channel-tools.ts` | æ¸ é“å·¥å…· | P1 |

### 2.4 æ¨¡å‹/è®¤è¯
| æ–‡ä»¶ | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `auth-profiles.ts` | è®¤è¯é…ç½® | P0 |
| `auth-profiles/` | è®¤è¯å®ç° | P0 |
| `auth-health.ts` | è®¤è¯å¥åº·æ£€æŸ¥ | P1 |
| `live-auth-keys.ts` | å®æ—¶å¯†é’¥ç®¡ç† | P1 |
| `live-model-filter.ts` | æ¨¡å‹è¿‡æ»¤ | P1 |
| `failover-error.ts` | æ•…éšœè½¬ç§» | P1 |

### 2.5 æ¨¡å‹ Provider (éœ€è¦æ‰©å±•)
| æ–‡ä»¶ | åŠŸèƒ½ | çŠ¶æ€ |
|------|------|------|
| `anthropic*.ts` | Anthropic Claude | âœ… å·²æœ‰ |
| `openai*.ts` | OpenAI | âœ… å·²æœ‰ |
| `minimax*.ts` | MiniMax | âœ… å·²æœ‰ |
| `qwen*.ts` | é€šä¹‰åƒé—® | ğŸŸ¡ éƒ¨åˆ† |
| `zhipu*.ts` | æ™ºè°± ChatGLM | ğŸ”´ éœ€æ–°å»º |
| `baidu*.ts` | æ–‡å¿ƒä¸€è¨€ | ğŸ”´ éœ€æ–°å»º |
| `deepseek*.ts` | DeepSeek | ğŸ”´ éœ€æ–°å»º |
| `spark*.ts` | è®¯é£æ˜Ÿç« | ğŸ”´ éœ€æ–°å»º |
| `moonshot*.ts` | æœˆä¹‹æš—é¢ Kimi | ğŸ”´ éœ€æ–°å»º |

---

## ä¸‰ã€Session ä¼šè¯ç®¡ç† (src/sessions/)

| æ–‡ä»¶ | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `session-key-utils.ts` | ä¼šè¯ Key å·¥å…· | P0 |
| `session-label.ts` | ä¼šè¯æ ‡ç­¾ | P0 |
| `send-policy.ts` | å‘é€ç­–ç•¥ | P0 |
| `level-overrides.ts` | çº§åˆ«è¦†ç›– | P1 |
| `model-overrides.ts` | æ¨¡å‹è¦†ç›– | P1 |
| `transcript-events.ts` | è®°å½•äº‹ä»¶ | P1 |

---

## å››ã€Config é…ç½®ç³»ç»Ÿ (src/config/)

| æ–‡ä»¶ | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `config.ts` | é…ç½®ä¸»å…¥å£ | P0 |
| `paths.ts` | è·¯å¾„é…ç½® | P0 |
| `defaults.ts` | é»˜è®¤å€¼ | P0 |
| `env-vars.ts` | ç¯å¢ƒå˜é‡ | P0 |
| `io.ts` | é…ç½®è¯»å†™ | P0 |
| `schema.ts` | é…ç½® Schema | P0 |
| `zod-schema.*.ts` | Zod éªŒè¯ | P0 |
| `types.ts` | ç±»å‹å®šä¹‰ | P0 |
| `legacy.ts` | æ—§ç‰ˆå…¼å®¹ | P2 |

---

## äº”ã€CLI å‘½ä»¤è¡Œ (src/cli/ + src/commands/)

### 5.1 CLI åŸºç¡€
| æ–‡ä»¶ | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `program.ts` | å‘½ä»¤ç¨‹åºä¸»å…¥å£ | P0 |
| `argv.ts` | å‚æ•°è§£æ | P0 |
| `deps.ts` | ä¾èµ–æ³¨å…¥ | P0 |
| `cli-utils.ts` | CLI å·¥å…·å‡½æ•° | P0 |
| `progress.ts` | è¿›åº¦æ˜¾ç¤º | P1 |
| `prompt.ts` | äº¤äº’æç¤º | P1 |

### 5.2 æ ¸å¿ƒå‘½ä»¤ (src/commands/)
| å‘½ä»¤ | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `gateway-*.ts` | Gateway ç®¡ç† | P0 |
| `agent*.ts` | Agent å¯¹è¯ | P0 |
| `onboard*.ts` | å¼•å¯¼é…ç½® | P0 |
| `doctor*.ts` | è¯Šæ–­å·¥å…· | P0 |
| `status*.ts` | çŠ¶æ€æŸ¥çœ‹ | P0 |
| `config*.ts` | é…ç½®ç®¡ç† | P0 |
| `message*.ts` | æ¶ˆæ¯å‘é€ | P1 |
| `sessions*.ts` | ä¼šè¯ç®¡ç† | P1 |
| `channels*.ts` | æ¸ é“ç®¡ç† | P1 |
| `models*.ts` | æ¨¡å‹ç®¡ç† | P1 |

---

## å…­ã€Channels æ¸ é“æŠ½è±¡å±‚ (src/channels/)

| æ–‡ä»¶ | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `registry.ts` | æ¸ é“æ³¨å†Œè¡¨ | P0 |
| `channel-config.ts` | æ¸ é“é…ç½® | P0 |
| `session.ts` | æ¸ é“ä¼šè¯ | P0 |
| `targets.ts` | å‘é€ç›®æ ‡ | P0 |
| `typing.ts` | è¾“å…¥çŠ¶æ€ | P1 |
| `allowlist-match.ts` | ç™½åå•åŒ¹é… | P1 |
| `mention-gating.ts` | @æåŠè¿‡æ»¤ | P1 |
| `command-gating.ts` | å‘½ä»¤è¿‡æ»¤ | P1 |
| `sender-identity.ts` | å‘é€è€…èº«ä»½ | P1 |
| `dock.ts` | æ¸ é“å¯¹æ¥ | P1 |

---

## ä¸ƒã€Routing è·¯ç”± (src/routing/)

| æ–‡ä»¶ | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `resolve-route.ts` | è·¯ç”±è§£æ | P0 |
| `session-key.ts` | ä¼šè¯ Key ç”Ÿæˆ | P0 |
| `bindings.ts` | ç»‘å®šå…³ç³» | P0 |

---

## å…«ã€Web/UI (src/web/ + ui/)

### 8.1 WebChat åç«¯
| æ–‡ä»¶ | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `auto-reply.ts` | è‡ªåŠ¨å›å¤ | P0 |
| `auto-reply.impl.ts` | å›å¤å®ç° | P0 |
| `inbound.ts` | å…¥ç«™æ¶ˆæ¯ | P0 |
| `outbound.ts` | å‡ºç«™æ¶ˆæ¯ | P0 |
| `session.ts` | Web ä¼šè¯ | P0 |
| `media.ts` | åª’ä½“å¤„ç† | P1 |

### 8.2 UI å‰ç«¯ (ui/)
| ç›®å½•/æ–‡ä»¶ | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|----------|------|--------|
| `src/` | React æºç  | P1 |
| `vite.config.ts` | æ„å»ºé…ç½® | P1 |
| `index.html` | å…¥å£ | P1 |

---

## ä¹ã€å·¥å…·æ¨¡å—

### 9.1 Browser æµè§ˆå™¨æ§åˆ¶ (src/browser/)
| åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|--------|
| Chromium CDP æ§åˆ¶ | P2 |
| æˆªå›¾/æ“ä½œ | P2 |

### 9.2 Cron å®šæ—¶ä»»åŠ¡ (src/cron/)
| åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|--------|
| å®šæ—¶ä»»åŠ¡è°ƒåº¦ | P2 |
| Webhook è§¦å‘ | P2 |

### 9.3 Media åª’ä½“å¤„ç† (src/media/)
| åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|--------|
| å›¾ç‰‡/éŸ³è§†é¢‘å¤„ç† | P1 |
| è½¬ç /å‹ç¼© | P1 |

---

## åã€æ—¥å¿—/å·¥å…· (src/logging/, src/utils/, src/infra/)

| æ¨¡å— | åŠŸèƒ½ | ä¼˜å…ˆçº§ |
|------|------|--------|
| `logging/` | æ—¥å¿—ç³»ç»Ÿ | P0 |
| `utils/` | å·¥å…·å‡½æ•° | P0 |
| `infra/` | åŸºç¡€è®¾æ–½ | P0 |
| `terminal/` | ç»ˆç«¯è¾“å‡º | P1 |
| `shared/` | å…±äº«ä»£ç  | P0 |

---

## å®ç°é˜¶æ®µè§„åˆ’

### Phase 1: æœ€å°å¯è¿è¡Œ (MVP Core)
1. Config é…ç½®ç³»ç»Ÿ
2. Gateway WebSocket æœåŠ¡
3. Agent Runtime åŸºç¡€
4. CLI åŸºç¡€å‘½ä»¤ (gateway/agent/status)
5. ä¸€ä¸ªæ¨¡å‹ Provider (é€šä¹‰åƒé—®æˆ– DeepSeek)
6. WebChat æ¸ é“

**ç›®æ ‡**: èƒ½é€šè¿‡ Web ç•Œé¢ä¸ AI å¯¹è¯

### Phase 2: Bç«¯æ¸ é“æ¥å…¥ âœ… å·²å®ŒæˆåŸºç¡€å®ç°
1. ä¼ä¸šå¾®ä¿¡æ¸ é“ âœ… `src/wecom/`
2. é’‰é’‰æ¸ é“ âœ… `src/dingtalk/`
3. é£ä¹¦æ¸ é“ âœ… `src/feishu/`
4. æ¸ é“æ’ä»¶ç³»ç»Ÿ âœ… `src/channels-cn/`

**å·²å®ç°å†…å®¹**:
- å„æ¸ é“ API å®¢æˆ·ç«¯ (Access Token, å‘æ¶ˆæ¯, è·å–ç”¨æˆ·ä¿¡æ¯)
- æ¶ˆæ¯åŠ è§£å¯† (AES-256-CBC)
- å›è°ƒå¤„ç† (URL éªŒè¯, æ¶ˆæ¯è§£æ)
- ChannelPlugin æ’ä»¶å®šä¹‰

**ä¸‹ä¸€æ­¥**: å®ç° outbound å‘é€å™¨å’Œ gateway é›†æˆ

**ç›®æ ‡**: Bç«¯ç”¨æˆ·å¯é€šè¿‡åŠå…¬è½¯ä»¶ä½¿ç”¨

### Phase 3: åŠŸèƒ½å®Œå–„
1. æ›´å¤šå›½äº§æ¨¡å‹ Provider
2. Cron å®šæ—¶ä»»åŠ¡
3. Skills æŠ€èƒ½ç³»ç»Ÿ
4. Browser æµè§ˆå™¨æ§åˆ¶
5. Doctor è¯Šæ–­å·¥å…·

### Phase 4: å¤šç«¯æ”¯æŒ
1. macOS App (Voice Wake + Talk Mode)
2. iOS Node
3. Android Node
4. Control UI ç®¡ç†åå°

---

## ä»£ç å¤ç”¨ç­–ç•¥

ç”±äº OpenClaw æ˜¯å¼€æºé¡¹ç›® (MIT License)ï¼Œå¯ä»¥ï¼š

1. **ç›´æ¥ Fork**: æœ€å¿«å¯åŠ¨ï¼Œä½†éœ€è¦å¤§é‡åˆ é™¤ä¸éœ€è¦çš„æ¸ é“ä»£ç 
2. **é€‰æ‹©æ€§å¤åˆ¶**: åªå¤åˆ¶æ ¸å¿ƒæ¨¡å—ï¼Œé‡æ–°ç»„ç»‡é¡¹ç›®ç»“æ„
3. **å‚è€ƒé‡å†™**: ç†è§£æ¶æ„åé‡æ–°å®ç°ï¼Œä»£ç æ›´å¹²å‡€

**å»ºè®®**: é€‰æ‹©æ€§å¤åˆ¶æ ¸å¿ƒæ¨¡å— + é‡å†™æ¸ é“å±‚
